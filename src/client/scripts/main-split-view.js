import{B as BaseView,a as Browser,F as FooterView,Q as QueryString,D as DialogView,S as ShareDialogView}from"./application.js";const global="undefined"!=typeof window?window:null,ssr=null===global,document$1=ssr?void 0:global.document,addEventListener="addEventListener",removeEventListener="removeEventListener",getBoundingClientRect="getBoundingClientRect",gutterStartDragging="_a",aGutterSize="_b",bGutterSize="_c",HORIZONTAL="horizontal",NOOP=()=>!1,calc=ssr?"calc":`${["","-webkit-","-moz-","-o-"].filter((t=>{const e=document$1.createElement("div");return e.style.cssText=`width:${t}calc(9px)`,!!e.style.length})).shift()}calc`,isString=t=>"string"==typeof t||t instanceof String,elementOrSelector=t=>{if(isString(t)){const e=document$1.querySelector(t);if(!e)throw new Error(`Selector ${t} did not match a DOM element`);return e}return t},getOption=(t,e,i)=>{const s=t[e];return void 0!==s?s:i},getGutterSize=(t,e,i,s)=>{if(e){if("end"===s)return 0;if("center"===s)return t/2}else if(i){if("start"===s)return 0;if("center"===s)return t/2}return t},defaultGutterFn=(t,e)=>{const i=document$1.createElement("div"),s=document$1.createElement("div");return i.className=`gutter gutter-${e}`,s.className="handle",i.appendChild(s),i},defaultElementStyleFn=(t,e,i)=>{const s={};return isString(e)?s[t]=e:s[t]=`${calc}(${e}% - ${i}px)`,s},defaultGutterStyleFn=(t,e)=>({[t]:`${e}px`}),Split=(t,e={})=>{if(ssr)return{};let i,s,n,o,a,l,r=t;Array.from&&(r=Array.from(r));const c=elementOrSelector(r[0]).parentNode,d=getComputedStyle?getComputedStyle(c):null,h=d?d.flexDirection:null;let u=getOption(e,"sizes")||r.map((()=>100/r.length));const p=getOption(e,"minSize",100),m=Array.isArray(p)?p:r.map((()=>p)),f=getOption(e,"maxSize",1/0),g=Array.isArray(f)?f:r.map((()=>f)),b=getOption(e,"expandToMin",!1),v=getOption(e,"gutterSize",10),w=getOption(e,"gutterAlign","center"),S=getOption(e,"snapOffset",30),y=Array.isArray(S)?S:r.map((()=>S)),C=getOption(e,"dragInterval",1),k=getOption(e,"direction",HORIZONTAL),z=getOption(e,"cursor",k===HORIZONTAL?"col-resize":"row-resize"),_=getOption(e,"gutter",defaultGutterFn),B=getOption(e,"elementStyle",defaultElementStyleFn),V=getOption(e,"gutterStyle",defaultGutterStyleFn);function M(t,e,s,n){const o=B(i,e,s,n);Object.keys(o).forEach((e=>{t.style[e]=o[e]}))}function D(){return l.map((t=>t.size))}function $(t){return"touches"in t?t.touches[0][s]:t[s]}function x(t){const e=l[this.a],i=l[this.b],s=e.size+i.size;e.size=t/this.size*s,i.size=s-t/this.size*s,M(e.element,e.size,this._b,e.i),M(i.element,i.size,this._c,i.i)}function O(t){let i;const s=l[this.a],n=l[this.b];this.dragging&&(i=$(t)-this.start+(this._b-this.dragOffset),C>1&&(i=Math.round(i/C)*C),i<=s.minSize+s.snapOffset+this._b?i=s.minSize+this._b:i>=this.size-(n.minSize+n.snapOffset+this._c)&&(i=this.size-(n.minSize+this._c)),i>=s.maxSize-s.snapOffset+this._b?i=s.maxSize+this._b:i<=this.size-(n.maxSize-n.snapOffset+this._c)&&(i=this.size-(n.maxSize+this._c)),x.call(this,i),getOption(e,"onDrag",NOOP)(D()))}function L(){const t=l[this.a].element,e=l[this.b].element,s=t[getBoundingClientRect](),a=e[getBoundingClientRect]();this.size=s[i]+a[i]+this._b+this._c,this.start=s[n],this.end=s[o]}function R(t){const e=function(t){if(!getComputedStyle)return null;const e=getComputedStyle(t);if(!e)return null;let i=t[a];return 0===i?null:(i-=k===HORIZONTAL?parseFloat(e.paddingLeft)+parseFloat(e.paddingRight):parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),i)}(c);if(null===e)return t;if(m.reduce(((t,e)=>t+e),0)>e)return t;let i=0;const s=[],n=t.map(((n,o)=>{const a=e*n/100,l=getGutterSize(v,0===o,o===t.length-1,w),r=m[o]+l;return a<r?(i+=r-a,s.push(0),r):(s.push(a-r),a)}));return 0===i?t:n.map(((t,n)=>{let o=t;if(i>0&&s[n]-i>0){const e=Math.min(i,s[n]-i);i-=e,o=t-e}return o/e*100}))}function N(){const t=this,i=l[t.a].element,s=l[t.b].element;t.dragging&&getOption(e,"onDragEnd",NOOP)(D()),t.dragging=!1,global[removeEventListener]("mouseup",t.stop),global[removeEventListener]("touchend",t.stop),global[removeEventListener]("touchcancel",t.stop),global[removeEventListener]("mousemove",t.move),global[removeEventListener]("touchmove",t.move),t.stop=null,t.move=null,i[removeEventListener]("selectstart",NOOP),i[removeEventListener]("dragstart",NOOP),s[removeEventListener]("selectstart",NOOP),s[removeEventListener]("dragstart",NOOP),i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",s.style.userSelect="",s.style.webkitUserSelect="",s.style.MozUserSelect="",s.style.pointerEvents="",t.gutter.style.cursor="",t.parent.style.cursor="",document$1.body.style.cursor=""}function E(t){if("button"in t&&0!==t.button)return;const i=this,s=l[i.a].element,n=l[i.b].element;i.dragging||getOption(e,"onDragStart",NOOP)(D()),t.preventDefault(),i.dragging=!0,i.move=O.bind(i),i.stop=N.bind(i),global[addEventListener]("mouseup",i.stop),global[addEventListener]("touchend",i.stop),global[addEventListener]("touchcancel",i.stop),global[addEventListener]("mousemove",i.move),global[addEventListener]("touchmove",i.move),s[addEventListener]("selectstart",NOOP),s[addEventListener]("dragstart",NOOP),n[addEventListener]("selectstart",NOOP),n[addEventListener]("dragstart",NOOP),s.style.userSelect="none",s.style.webkitUserSelect="none",s.style.MozUserSelect="none",s.style.pointerEvents="none",n.style.userSelect="none",n.style.webkitUserSelect="none",n.style.MozUserSelect="none",n.style.pointerEvents="none",i.gutter.style.cursor=z,i.parent.style.cursor=z,document$1.body.style.cursor=z,L.call(i),i.dragOffset=$(t)-i.end}k===HORIZONTAL?(i="width",s="clientX",n="left",o="right",a="clientWidth"):"vertical"===k&&(i="height",s="clientY",n="top",o="bottom",a="clientHeight"),u=R(u);const A=[];function I(t){const e=t.i===A.length,i=e?A[t.i-1]:A[t.i];L.call(i);const s=e?i.size-t.minSize-i._c:t.minSize+i._b;x.call(i,s)}return l=r.map(((t,e)=>{const s={element:elementOrSelector(t),size:u[e],minSize:m[e],maxSize:g[e],snapOffset:y[e],i:e};let n;if(e>0&&(n={a:e-1,b:e,dragging:!1,direction:k,parent:c},n._b=getGutterSize(v,e-1==0,!1,w),n._c=getGutterSize(v,!1,e===r.length-1,w),"row-reverse"===h||"column-reverse"===h)){const t=n.a;n.a=n.b,n.b=t}if(e>0){const t=_(e,k,s.element);!function(t,e,s){const n=V(i,e,s);Object.keys(n).forEach((e=>{t.style[e]=n[e]}))}(t,v,e),n._a=E.bind(n),t[addEventListener]("mousedown",n._a),t[addEventListener]("touchstart",n._a),c.insertBefore(t,s.element),n.gutter=t}return M(s.element,s.size,getGutterSize(v,0===e,e===r.length-1,w),e),e>0&&A.push(n),s})),l.forEach((t=>{const e=t.element[getBoundingClientRect]()[i];e<t.minSize&&(b?I(t):t.minSize=e)})),{setSizes:function(t){const e=R(t);e.forEach(((t,i)=>{if(i>0){const s=A[i-1],n=l[s.a],o=l[s.b];n.size=e[i-1],o.size=t,M(n.element,n.size,s._b,n.i),M(o.element,o.size,s._c,o.i)}}))},getSizes:D,collapse(t){I(l[t])},destroy:function(t,e){A.forEach((s=>{if(!0!==e?s.parent.removeChild(s.gutter):(s.gutter[removeEventListener]("mousedown",s._a),s.gutter[removeEventListener]("touchstart",s._a)),!0!==t){const t=B(i,s.a.size,s._b);Object.keys(t).forEach((t=>{l[s.a].element.style[t]="",l[s.b].element.style[t]=""}))}}))},parent:c,pairs:A}};var Split$1=Split,SplitView=BaseView.extend({className:"split-view",template1:_.template('<div class="split sidebar"></div><div class="split mainbar"></div>'),template2:_.template('<div class="split mainbar"></div><div class="split sidebar"></div>'),regions:{sidebar:{el:".sidebar",replaceElement:!1},mainbar:{el:".mainbar",replaceElement:!1}},events:{"dblclick > .gutter":"onDoubleClickGutter","tap > .gutter":"onTapGutter"},sizes:[33,67],gutter_size:2,mobile_gutter_size:0,prevSizes:[],minSizes:0,orientation:"horizontal",flipped:!1,initialize:function(){null!=this.options.orientation&&(this.orientation=this.options.orientation),this.options.sizes&&(this.sizes=this.options.sizes),this.options.minSizes&&(this.minSizes=this.options.minSizes),this.options.sidebar_size&&(this.flipped?this.sizes=[100-this.options.sidebar_size,this.options.sidebar_size]:this.sizes=[this.options.sidebar_size,100-this.options.sidebar_size]),this.initialSizes=this.sizes.clone()},isSideBarVisible:function(){return this.$el.find("> .sidebar").is(":visible")},isSideBarHidden:function(){return this.splitter.hidden},isSideBarOpen:function(){return this.flipped?this.getSizes()[1]>this.getGutterSize():this.getSizes()[0]>this.getGutterSize()},getGutterSize:function(){return Browser.is_mobile?this.mobile_gutter_size:this.gutter_size},getSizes:function(){return this.splitter.getSizes()},getInitialSideBarSize:function(){return this.flipped?this.initialSizes[1]||50:this.initialSizes[0]||50},setModel:function(t){this.hasChildView("sidebar")&&this.getChildView("sidebar").setModel&&this.getChildView("sidebar").setModel(t),this.hasChildView("mainbar")&&this.getChildView("mainbar").setModel&&this.getChildView("mainbar").setModel(t)},setOrientation:function(t){switch(t){case"horizontal":this.$el.find("> .split").removeClass("split-vertical").addClass("split-horizontal");break;case"vertical":this.$el.find("> .split").removeClass("split-horizontal").addClass("split-vertical")}},setSideBarSize:function(t){this.flipped?this.sizes=[100-t,t]:this.sizes=[t,100-t],this.splitter.setSizes(this.sizes),this.adjustSizes(),this.onResize()},setSideBarMinSize:function(t){this.setMinSizes([t,0])},setMinSizes:function(t){if(t[0])switch(this.orientation){case"horizontal":this.$el.find(".sidebar").css("min-width",t[0]+"px");break;case"vertical":this.$el.find(".sidebar").css("min-height",t[0]+"px")}if(t[1])switch(this.orientation){case"horizontal":this.$el.find(".mainbar").css("min-width",t[1]+"px");break;case"vertical":this.$el.find(".mainbar").css("min-height",t[1]+"px")}},setSideBarVisibility:function(t){t?this.showSideBar():this.hideSideBar()},resetSideBar:function(){this.splitter.setSizes(this.options.sizes||this.sizes),this.onResize()},pixelsToPercent:function(t){for(let e=0;e<t.length;e++)"string"==typeof t[e]&&t[e].contains("px")&&(t[e]=parseInt(t[e].replace("px",""))/this.$el.width()*100);let e=0,i=0;for(let s=0;s<t.length;s++)t[s]&&(e+=t[s],i++);if(e<100){let s=(100-e)/(t.length-i);for(let e=0;e<t.length;e++)t[e]||(t[e]=s)}return t},openSideBar:function(){this.setSideBarSize(this.getInitialSideBarSize()),this.onResize()},closeSideBar:function(){this.prevSizes=this.getSizes(),this.setSideBarSize(0)},toggleSideBar:function(){this.isSideBarOpen()?this.closeSideBar():this.openSideBar()},hideSideBar:function(){this.splitter.hidden||(this.closeSideBar(),this.$el.find("> .sidebar").hide(),this.$el.find("> .gutter").hide(),this.$el.find("> .mainbar").css({width:"100%",height:"100%"}),this.splitter.hidden=!0)},showSideBar:function(){this.splitter.hidden&&(this.$el.find("> .sidebar").show(),this.$el.find("> .gutter").show(),this.openSideBar(),this.onResize(),this.splitter.hidden=!1)},getTemplate:function(){return this.flipped?this.template2:this.template1},onRender:function(){this.showSplitter(),this.getSideBarView&&this.showChildView("sidebar",this.getSideBarView()),this.getMainBarView&&this.showChildView("mainbar",this.getMainBarView()),0==this.show_sidebar&&this.hideSideBar()},onAttach:function(){this.splitter.hidden||this.adjustSizes()},showSplitter:function(){this.setOrientation(this.orientation),this.splitter=Split$1(this.flipped?[this.$el.find("> .mainbar")[0],this.$el.find("> .sidebar")[0]]:[this.$el.find("> .sidebar")[0],this.$el.find("> .mainbar")[0]],{direction:this.orientation,sizes:this.sizes,minSize:this.minSizes,gutterSize:this.getGutterSize(),onDrag:()=>{this.onResize()}})},update:function(){this.hasChildView("sidebar")&&this.getChildView("sidebar").update&&this.getChildView("sidebar").update(),this.hasChildView("mainbar")&&this.getChildView("mainbar").update&&this.getChildView("mainbar").update()},adjustWidths:function(){let t=this.getGutterSize();this.flipped?(100==this.sizes[1]&&this.$el.find("> .sidebar").css({width:"calc(100% - "+t+"px)"}),100==this.sizes[0]&&this.$el.find("> .mainbar").css({width:"calc(100% - "+t+"px)"})):(100==this.sizes[0]&&this.$el.find("> .sidebar").css({width:"calc(100% - "+t+"px)"}),100==this.sizes[1]&&this.$el.find("> .mainbar").css({width:"calc(100% - "+t+"px)"}))},adjustHeights:function(){let t=this.getGutterSize();this.flipped?(100==this.sizes[1]&&this.$el.find("> .sidebar").css({height:"calc(100% - "+t+"px)"}),100==this.sizes[0]&&this.$el.find("> .mainbar").css({height:"calc(100% - "+t+"px)"})):(100==this.sizes[0]&&this.$el.find("> .sidebar").css({height:"calc(100% - "+t+"px)"}),100==this.sizes[1]&&this.$el.find("> .mainbar").css({height:"calc(100% - "+t+"px)"}))},adjustSizes:function(){switch(this.orientation){case"horizontal":this.adjustWidths();break;case"vertical":this.adjustHeights()}},onLoad:function(){this.isDestroyed()||(this.hasChildView("sidebar")&&this.getChildView("sidebar").onLoad&&this.getChildView("sidebar").onLoad(),this.hasChildView("mainbar")&&this.getChildView("mainbar").onLoad&&this.getChildView("mainbar").onLoad())},onChange:function(){this.hasChildView("sidebar")&&this.getChildView("sidebar").onChange&&this.getChildView("sidebar").onChange(),this.hasChildView("mainbar")&&this.getChildView("mainbar").onChange&&this.getChildView("mainbar").onChange()},onDoubleClickGutter:function(){this.resetSideBar()},onTapGutter:function(){Browser.is_mobile&&this.toggleSideBar()},onResize:function(t){this.hasChildView("sidebar")&&this.getChildView("sidebar").onResize&&this.getChildView("sidebar").onResize(t),this.hasChildView("mainbar")&&this.getChildView("mainbar").onResize&&this.getChildView("mainbar").onResize(t)}});!function(t){var e=function(i,s){this.$element=t(i),this.options=t.extend({},e.DEFAULTS,s),this.$trigger=t('[data-toggle="collapse"][href="#'+i.id+'"],[data-toggle="collapse"][data-target="#'+i.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function i(e){var i,s=e.attr("data-target")||(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"");return t(s)}function s(i){return this.each((function(){var s=t(this),n=s.data("bs.collapse"),o=t.extend({},e.DEFAULTS,s.data(),"object"==typeof i&&i);!n&&o.toggle&&/show|hide/.test(i)&&(o.toggle=!1),n||s.data("bs.collapse",n=new e(this,o)),"string"==typeof i&&n[i]()}))}e.VERSION="3.3.7",e.TRANSITION_DURATION=350,e.DEFAULTS={toggle:!0},e.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},e.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var i,n=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(n&&n.length&&(i=n.data("bs.collapse"))&&i.transitioning)){var o=t.Event("show.bs.collapse");if(this.$element.trigger(o),!o.isDefaultPrevented()){n&&n.length&&(s.call(n,"hide"),i||n.data("bs.collapse",null));var a=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[a](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var l=function(){this.$element.removeClass("collapsing").addClass("collapse in")[a](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!t.support.transition)return l.call(this);var r=t.camelCase(["scroll",a].join("-"));this.$element.one("bsTransitionEnd",t.proxy(l,this)).emulateTransitionEnd(e.TRANSITION_DURATION)[a](this.$element[0][r])}}}},e.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var i=t.Event("hide.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){var s=this.dimension();this.$element[s](this.$element[s]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var n=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!t.support.transition)return n.call(this);this.$element[s](0).one("bsTransitionEnd",t.proxy(n,this)).emulateTransitionEnd(e.TRANSITION_DURATION)}}},e.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},e.prototype.getParent=function(){return t(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(t.proxy((function(e,s){var n=t(s);this.addAriaAndCollapsedClass(i(n),n)}),this)).end()},e.prototype.addAriaAndCollapsedClass=function(t,e){var i=t.hasClass("in");t.attr("aria-expanded",i),e.toggleClass("collapsed",!i).attr("aria-expanded",i)};var n=t.fn.collapse;t.fn.collapse=s,t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',(function(e){var n=t(this);n.attr("data-target")||e.preventDefault();var o=i(n),a=o.data("bs.collapse")?"toggle":n.data();s.call(o,a)}))}(jQuery);var SideBarView=BaseView.extend({className:"content",template:_.template('\n\t\t<div id="footer"></div>\n\t'),regions:{footer:"#footer"},onRender:function(){this.showBody(),this.showFooter()},showBody:function(){application.fetchTemplate("home",(t=>{this.$el.prepend(t)}))},showFooter:function(){this.showChildView("footer",new FooterView)}}),ToolbarView=BaseView.extend({className:"toolbar",initialize:function(t){this.options=t||{},this.parent=t?t.parent:void 0},onRender:function(){this.addTooltips()},isVisible:function(){return this.$el.is(":visible")}}),MapBarView=ToolbarView.extend({id:"map-bar",className:"vertical toolbar",template:_.template('\n\t\t<div class="title">Map</div>\n\n\t\t<div class="buttons">\n\t\t\t<button id="map-mode" data-toggle="tooltip" title="Map Mode" data-placement="left">\n\t\t\t\t<i class="fa fa-compass"></i>\n\t\t\t</button>\n\n\t\t\t<button id="aerial-mode" data-toggle="tooltip" title="Aerial Mode" data-placement="left">\n\t\t\t\t<i class="fa fa-plane"></i>\n\t\t\t</button>\n\n\t\t\t<button id="hybrid-mode" data-toggle="tooltip" title="Hybrid Mode" data-placement="left">\n\t\t\t\t<i class="fa fa-font"></i>\n\t\t\t</button>\n\n\t\t\t<button id="colorful-mode" data-toggle="tooltip" title="Colorful Mode" data-placement="left">\n\t\t\t\t<i class="fa fa-rainbow"></i>\n\t\t\t</button>\n\n\t\t\t<button id="dark-mode" data-toggle="tooltip" title="Dark Mode" data-placement="left">\n\t\t\t\t<i class="fa fa-circle-half-stroke"></i>\n\t\t\t</button>\n\n\t\t\t<button id="show-markers" data-toggle="tooltip" title="Show Markers" data-placement="left">\n\t\t\t\t<i class="fa fa-map-marker"></i>\n\t\t\t</button>\n\t\t</div>\n\t'),events:{"click #map-mode":"onClickMapMode","click #aerial-mode":"onClickAerialMode","click #hybrid-mode":"onClickHybridMode","click #colorful-mode":"onClickColorfulMode","click #dark-mode":"onClickDarkMode","click #show-markers":"onClickShowMarkers"},isButtonSelected:function(t){return this.$el.find("#"+t).hasClass("selected")},getMapMode:function(){return this.$el.find("#show-map-mode").hasClass("selected")?"map":this.$el.find("#aerial-mode").hasClass("selected")?"aerial":this.$el.find("#hybrid-mode").hasClass("selected")?"hybrid":void 0},getQueryParams:function(){let t=new URLSearchParams;return this.addQueryParams(t),t},setMapButtonMode:function(t){switch(t){case"map":this.selectButton("map-mode"),this.deselectButton("aerial-mode"),this.deselectButton("hybrid-mode");break;case"aerial":this.deselectButton("map-mode"),this.selectButton("aerial-mode"),this.deselectButton("hybrid-mode");break;case"hybrid":this.deselectButton("map-mode"),this.deselectButton("aerial-mode"),this.selectButton("hybrid-mode")}},setMapMode:function(t){this.setMapButtonMode(t),this.parent.setMapMode(t)},setQueryParams:function(t){t.mode&&this.setMapMode(t.mode)},setMode:function(t){this.getMapMode()!=t&&this.setMapMode(t)},setShowMarkers:function(t){t?$("body").removeClass("hide-markers"):$("body").addClass("hide-markers")},setShowColors:function(t){t?$("body").addClass("colorful"):$("body").removeClass("colorful")},setDarkMode:function(t){t?$("body").addClass("dark"):$("body").removeClass("dark")},toggleColorfulMode:function(){this.isButtonSelected("colorful-mode")?(this.deselectButton("colorful-mode"),this.setShowColors(!1)):(this.selectButton("colorful-mode"),this.setShowColors(!0))},toggleDarkMode:function(){this.isButtonSelected("dark-mode")?(this.deselectButton("dark-mode"),this.setDarkMode(!1)):(this.selectButton("dark-mode"),this.setDarkMode(!0))},toggleShowMarkers:function(){this.isButtonSelected("show-markers")?(this.deselectButton("show-markers"),this.setShowMarkers(!1)):(this.selectButton("show-markers"),this.setShowMarkers(!0))},selectButton:function(t){this.$el.find("#"+t).addClass("selected")},deselectButton:function(t){this.$el.find("#"+t).removeClass("selected")},updateQueryString:function(){let t=this.getMapMode();"map"!=t?QueryString.add("mode",t):QueryString.remove("mode"),this.isButtonSelected("colorful-mode")?QueryString.add("colorful",!0):QueryString.remove("colorful"),this.isButtonSelected("dark-mode")?QueryString.add("dark",!0):QueryString.remove("dark"),this.isButtonSelected("show-markers")?QueryString.remove("markers"):QueryString.add("markers",!1)},addQueryParams:function(t){let e=this.getMapMode();return"map"!=e&&t.set("mode",e),t},onRender:function(){ToolbarView.prototype.onRender.call(this),this.setMapButtonMode(QueryString.value("mode")||defaults.map.mode),"false"!=QueryString.value("markers")?this.toggleShowMarkers():this.setShowMarkers(!1),QueryString.value("colorful")&&this.toggleColorfulMode(),QueryString.value("dark")&&this.selectButton("dark-mode")},onClickMapMode:function(){this.setMode("map"),this.updateQueryString()},onClickAerialMode:function(){this.setMode("aerial"),this.updateQueryString()},onClickHybridMode:function(){this.setMode("hybrid"),this.updateQueryString()},onClickColorfulMode:function(){this.toggleColorfulMode(),this.updateQueryString()},onClickDarkMode:function(){this.toggleDarkMode(),this.updateQueryString()},onClickShowMarkers:function(){this.toggleShowMarkers(),this.updateQueryString()}}),ZoomBarView=ToolbarView.extend({id:"zoom-bar",className:"vertical toolbar",template:_.template('\n\t\t<div class="buttons">\n\t\t\t<button id="zoom-in" data-toggle="tooltip" title="Zoom In" data-placement="left"><i class="fa fa-plus"></i></button>\n\t\t\t<div class="current" data-toggle="tooltip" title="Zoom Level" data-placement="left">1</div>\n\t\t\t<button id="zoom-out" data-toggle="tooltip" title="Zoom Out" data-placement="left"><i class="fa fa-minus"></i></button>\n\t\t</div>\n\t'),events:{"click #zoom-in":"onClickZoomIn","click #zoom-out":"onClickZoomOut"},setZoomLevel:function(t){this.$el.find(".current").text(Math.round(t))},onRender:function(){ToolbarView.prototype.onRender.call(this),this.setZoomLevel(this.options.zoomLevel)},onClickZoomIn:function(){this.parent.zoomIn()},onClickZoomOut:function(){this.parent.zoomOut()}}),FullScreenable={isFullSize:function(){return window.innerWidth==screen.width&&window.innerHeight==screen.height},isFullScreen:function(){return null!=document.fullScreenElement&&null!==document.fullScreenElement||null!=document.mozFullScreen&&!0===document.mozFullScreen||null!=document.webkitIsFullScreen&&!0===document.webkitIsFullScreen},requestFullScreen:function(t){t||(t=document.documentElement),t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(t.ALLOW_KEYBOARD_INPUT)},exitFullScreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},toggleFullScreen:function(t){this.isFullScreen()?this.exitFullScreen():this.requestFullScreen(t)}},BaseMapView=BaseView.extend(_.extend({},FullScreenable,{baseMaps:{map:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{}),aerial:L.tileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"]}),hybrid:L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{subdomains:["mt0","mt1","mt2","mt3"]})},template:_.template('\n\t\t<div id="map"></div>\n\n\t\t<div id="user-interface">\n\t\t\t<div id="map-bar"></div>\n\t\t\t<div id="zoom-bar"></div>\n\t\t</div>\n\t'),regions:{map:{el:"#map-bar",replaceElement:!0},zoom:{el:"#zoom-bar",replaceElement:!0}},mode:void 0,initialize:function(){let t=parseFloat(QueryString.value("lat")),e=parseFloat(QueryString.value("lng"));for(;e<0;)e+=360;for(;e>180;)e-=360;this.mode=QueryString.value("mode")||defaults.map.mode,this.zoomLevel=QueryString.value("zoom")||defaults.map.zoom,this.center=t&&e?[t,e]:defaults.map.center},getMapMode:function(){return this.mode},getZoomLevel:function(){return this.map.getZoom()},setMapMode:function(t){this.baseLayer&&this.map.removeLayer(this.baseLayer),this.baseLayer=this.baseMaps[t],this.baseLayer.addTo(this.map);let e=this.$el.find("#map");switch(t){case"map":e.removeClass("aerial"),e.removeClass("hybrid");break;case"aerial":e.addClass("aerial"),e.removeClass("hybrid");break;case"hybrid":e.removeClass("aerial"),e.addClass("hybrid")}},setZoomLevel:function(t){this.map.setZoom(t)},zoomIn:function(){this.setZoomLevel(this.getZoomLevel()+1)},zoomOut:function(){this.setZoomLevel(this.getZoomLevel()-1)},onAttach:function(){this.showBaseMap(),this.showToolbars(),this.map.on("zoom",(()=>{this.onZoom()}))},showBaseMap:function(){this.map=L.map("map",defaults.leaflet).setView(this.center,this.zoomLevel),this.setMapMode(this.mode),this.addMapDragCallback()},addMapDragCallback:function(){this.map.on("dragend",(()=>{this.onPan()}))},showToolbars:function(){let t=Object.keys(this.regions);for(let e=0;e<t.length;e++)this.showToolbar(t[e])},showToolbar:function(t){switch(t){case"map":this.showMapBar();break;case"zoom":this.showZoomBar()}},showMapBar:function(){this.showChildView("map",new MapBarView({parent:this}))},showZoomBar:function(){this.showChildView("zoom",new ZoomBarView({zoomLevel:this.zoomLevel,parent:this}))},onPan:function(){let t=this.map.getCenter();for(;t.lng<0;)t.lng+=360;for(;t.lng>180;)t.lng-=360;QueryString.add({lat:t.lat,lng:t.lng})},onZoom:function(){QueryString.add({zoom:this.getZoomLevel()}),this.getChildView("zoom").setZoomLevel(this.getZoomLevel())},onBeforeDestroy:function(){this.map&&this.map.remove&&(this.map.off(),this.map.remove(),this.map=null)}})),DataBarView=ToolbarView.extend({id:"data-bar",className:"vertical toolbar",template:_.template('\n\t\t<div class="title">Data</div>\n\n\t\t<div class="buttons">\n\t\t\t<button class="habitat-mapper data-source" data-source="habitat-mapper" data-toggle="tooltip" title="GLOBE Habitat Mapper" data-placement="right">\n\t\t\t\t<i class="fa fa-earth"></i>\n\t\t\t</button>\n\n\t\t\t<button class="land-cover data-source" data-source="land-cover" data-toggle="tooltip" title="GLOBE Land Cover" data-placement="right">\n\t\t\t\t<i class="fa fa-earth"></i>\n\t\t\t</button>\n\n\t\t\t<button class="inaturalist data-source" data-source="inaturalist" data-toggle="tooltip" title="iNaturalist" data-placement="right">\n\t\t\t\t<img class="icon" src="images/logos/inaturalist.png" />\n\t\t\t</button>\n\n\t\t\t<button class="mosquito-alert data-source" data-source="mosquito-alert" data-toggle="tooltip" title="Mosquito Alert" data-placement="right">\n\t\t\t\t<i class="fa fa-exclamation-triangle"></i>\n\t\t\t</button>\n\t\t</div>\n\t'),events:{"click .data-source":"onClickDataSource"},isDataSourceSelected:function(t){return this.$el.find("."+t).hasClass("selected")},numSources:function(){return this.$el.find("button").length},getSourceByIndex:function(t){return $(this.$el.find("button")[t]).attr("data-source")},getSources:function(){let t=this.$el.find("button"),e=[];for(let i=0;i<t.length;i++)e.push(i+1);return e},getSelectedSources:function(){let t=this.$el.find("button"),e=[];for(let i=0;i<t.length;i++){let s=t[i];$(s).hasClass("selected")&&e.push(i+1)}return e},selectAll:function(){let t=this.numSources();for(let e=0;e<t;e++){let t=this.getSourceByIndex(e);this.select(t)}},deselectAll:function(){let t=this.numSources();for(let e=0;e<t;e++){let t=this.getSourceByIndex(e);this.deselect(t)}},select:function(t){this.$el.find("button."+t).addClass("selected"),this.parent.showDataSource(t)},deselect:function(t){this.$el.find("button."+t).removeClass("selected"),this.parent.hideDataSource(t)},toggle:function(t){this.isDataSourceSelected(t)?this.deselect(t):this.select(t)},selectByIndices:function(t){if(t){let e=this.numSources();for(let i=0;i<e;i++){let e=this.getSourceByIndex(i);t.includes(i+1)?this.select(e):this.deselect(e)}}else this.deselectAll()},onRender:function(){ToolbarView.prototype.onRender.call(this);let t=QueryString.value("data");if(t){let e=t.split(",");for(let t=0;t<e.length;t++)e[t]=parseInt(e[t]);this.selectByIndices(e)}else this.selectAll()},onClickDataSource:function(t){let e=$(t.target).closest("button").attr("data-source");this.toggle(e);let i=this.getSelectedSources();i.length<this.numSources()?i.length>0?QueryString.add("data",i):QueryString.add("data",0):QueryString.remove("data")}}),BaseModel=Backbone.Model.extend({is:function(t){if(!t)return!1;if(this==t)return!0;let e=this.get(this.idAttribute);return e&&e==t.get(t.idAttribute)},getClassName:function(){return this.constructor.name?this.constructor.name:"model"}}),Country=BaseModel.extend({urlRoot:config.server+"/countries",getFlag:function(){return this.get("iso").toLowerCase()}}),BaseCollection=Backbone.Collection.extend({contains:function(t){for(let e=0;e<this.length;e++)if(this.at(e)==t)return!0;return!1},indexOf:function(t){for(let e=0;e<this.length;e++)if(this.at(e)==t)return e},includes:function(t){for(let e=0;e<this.length;e++)if(this.at(e).is(t))return!0;return!1},indexOfValue:function(t){for(let e=0;e<this.length;e++)if(this.at(e).is(t))return e},getAttributes:function(t){let e=[];return this.each((i=>{e.push(i.get(t))})),e},getByRange:function(t,e){let i=new this.constructor([],{model:this.model,comparator:this.comparator});for(let s=t;s<=e;s++)i.add(this.at(s));return i},getByAttribute:function(t,e){let i=new this.constructor([],{model:this.model,comparator:this.comparator});return this.each((s=>{s.get(t).toLowerCase()==e&&i.add(s)})),i},getByNotAttribute:function(t,e){let i=new this.constructor([],{model:this.model,comparator:this.comparator});return this.each((s=>{s.get(t).toLowerCase()!=e&&i.add(s)})),i},save:function(t){let e=0,i=0,s=0,n=0;function o(o,a){e++,o.isNew()||o.hasChanged()?(i++,o.save(void 0,{success:()=>{s++,e===a.length&&s===i&&t&&t.success&&t.success()},error:()=>{n++,1===n&&t&&t.error&&t.error()}})):e===a.length&&s===i&&t&&t.success&&t.success()}for(let t=0;t<this.length;t++)o(this.at(t),this);0===i&&t&&t.success&&t.success()},destroy:function(t){let e=0,i=0,s=this.length,n=[];function o(o,a){o.destroy({success:i=>{e++,n.push(i),e===s&&(a.reset(),t&&t.success&&t.success(n))},error:(e,s)=>{i++,1===i&&t&&t.error&&t.error(e,s)}})}for(let t=0;t<s;t++)o(this.pop(),this);0===s&&t&&t.success&&t.success()},sortByAttribute:function(t,e){this.reset(this.sortBy((i=>e&&e.comparator?e.comparator(i.get(t)):i.get(t)))),e&&e.reverse&&this.reverse()},sortedByAttribute:function(t,e){let i=new this.constructor(this.sortBy((i=>e&&e.comparator?e.comparator(i.get(t)):i.get(t))));return e&&e.reverse&&i.reverse(),i},reverse:function(){let t=this.models;this.reset(),this.add(t.reverse())}}),NamedItems=BaseCollection.extend({getNames:function(){let t=[];for(let e=0;e<this.length;e++)t.push(this.at(e).get("name"));return t},getByName:function(t){for(let e=0;e<this.length;e++){let i=this.at(e);if(i.get("name")===t)return i}},removeDuplicateNames:function(){let t={},e=[];this.each((function(i){t[i.get("name")]?e.push(i):t[i.get("name")]=!0})),this.remove(e)},distinguishRepeatedNames:function(t){t||(t={}),this.each((function(e){t[e.get("name")]?(t[e.get("name")]++,e.set("name",e.get("name")+" ("+t[e.get("name")]+")")):t[e.get("name")]=1}))},sort:function(){this.sortByAttribute("name",{comparator:function(t){return t.toLowerCase()}})},sorted:function(){return this.sortedByAttribute("name",{comparator:function(t){return t.toLowerCase()}})}}),Countries=NamedItems.extend({model:Country,url:config.server+"/countries"}),FilterDialogView=DialogView.extend({events:{keydown:"onKeyDown","click #ok":"onClickOk"},closeDialog:function(){this.$el.modal("hide"),this.onClose&&this.onClose(),application.getMapView().update()},onClickOk:function(){this.closeDialog()},onKeyDown:function(t){13==t.keyCode&&this.closeDialog()}}),ItemsSelectorView=BaseView.extend({template:_.template('\n\t\t<div class="item form-check">\n\t\t\t<input class="form-check-input" type="checkbox" id="all">\n\t\t\t<label class="form-check-label" for="all">\n\t\t\t\tAll\n\t\t\t</label>\n\t\t</div>\n\t\t<div class="items"></div>\n\t'),item:_.template('\n\t\t<div class="item form-check">\n\t\t\t<input class="form-check-input" type="checkbox" id="item-<%= id %>">\n\t\t\t<label class="form-check-label" for="item-<%= id %>">\n\t\t\t\t<%= name %>\n\t\t\t</label>\n\t\t</div>\n\t'),events:{"change #all":"onChangeAll"},numItems:function(){return this.$el.find(".item").length},getSelectedIndices:function(){if(0==this.$el.find("input:not(:checked").length)return null;let t=[],e=this.$el.find("input");for(let i=0;i<e.length;i++){let s=e[i];$(s).is(":checked")&&t.push(i)}return t},selectAll:function(){this.$el.find("input").prop("checked",!0),this.$el.find("#all").prop("checked",!0)},deselectAll:function(){this.$el.find("input").prop("checked",!1),this.$el.find("#all").prop("checked",!1)},selectItems:function(t){let e=this.$el.find("input");for(let i=1;i<e.length;i++){let s=e[i];$(s).prop("checked",t.includes(i))}},selectItemsFromQueryString:function(t){let e=QueryString.value(t);if(e){e=e.split(",");for(let t=0;t<e.length;t++)e[t]=parseInt(e[t]);this.selectItems(e)}else this.selectAll()},onRender:function(){this.collection.fetch({success:t=>{this.onLoad(t)}})},clear:function(){this.$el.find(".items").empty()},addItem:function(t,e){this.$el.find(".items").append(this.item({id:t,name:e}))},onLoad:function(t){this.showItems(t)},onChangeAll:function(t){$(t.target).is(":checked")?this.selectAll():this.deselectAll()}}),CountriesSelectorView=ItemsSelectorView.extend({initialize:function(){this.collection=new Countries},showItems:function(t){this.clear();for(let e=0;e<t.length;e++){let i=t.at(e),s=i.attributes[0],n=i.attributes[3];this.addItem(s,n)}},onLoad:function(t){this.showItems(t),this.selectItemsFromQueryString("countries")}}),CountriesSelectorDialogView=FilterDialogView.extend({className:"modal narrow",icon:"fa fa-globe",title:"Select Countries",template:_.template('\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">\n\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t</button>\n\t\t\t<h1 id="modal-header-text">\n\t\t\t\t<i class="<%= icon %>"></i>\n\t\t\t\t<%= title %>\n\t\t\t</h1>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<p>Please select the countries that you are interested in:</p>\n\t\t\t<div class="selector"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button id="ok" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i>OK</button>\n\t\t\t<button id="cancel" class="btn" data-dismiss="modal"><i class="fa fa-close"></i>Cancel</button>\n\t\t</div>\n\t'),regions:{selector:".selector"},templateContext:function(){return{icon:this.icon,title:this.title}},onRender:function(){this.showChildView("selector",new CountriesSelectorView({collection:this.collection}))},onClose:function(){let t=this.getChildView("selector").getSelectedIndices();t?(QueryString.add("countries",t),this.options.opener.selectButton("country")):(QueryString.remove("countries",t),this.options.opener.deselectButton("country"))}}),DateRangeSelectorView=BaseView.extend({template:_.template('\n\t\t<div class="form-group">\n\t\t\t<label for="start-date">Start date:</label>\n\t\t\t<input type="date" class="form-control" id="start-date" value="<%= start_date %>">\n\t\t</div>\n\n\t\t<div class="form-group">\n\t\t\t<label for="end-date">End date:</label>\n\t\t\t<input type="date" class="form-control" id="end-date" value="<%= end_date %>">\n\t\t</div>\n\t'),hasValue:function(t){switch(t){case"start_date":return""!=this.getValue("start_date");case"end_date":return""!=this.getValue("end_date")}},getValue:function(t){switch(t){case"start_date":return this.$el.find("#start-date").val();case"end_date":return this.$el.find("#end-date").val()}},templateContext:function(){return this.options}}),DateRangeSelectorDialogView=FilterDialogView.extend({className:"modal narrow",icon:"fa fa-calendar",title:"Select Date",template:_.template('\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">\n\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t</button>\n\t\t\t<h1 id="modal-header-text">\n\t\t\t\t<i class="<%= icon %>"></i>\n\t\t\t\t<%= title %>\n\t\t\t</h1>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<p>Please select the date range that you are interested in:</p>\n\t\t\t<div class="selector"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button id="ok" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i>OK</button>\n\t\t\t<button id="cancel" class="btn" data-dismiss="modal"><i class="fa fa-close"></i>Cancel</button>\n\t\t</div>\n\t'),regions:{selector:".selector"},hasValue:function(t){return this.getChildView("selector").hasValue(t)},getValue:function(t){return this.getChildView("selector").getValue(t)},templateContext:function(){return{icon:this.icon,title:this.title}},onRender:function(){this.showChildView("selector",new DateRangeSelectorView({start_date:QueryString.value("after"),end_date:QueryString.value("before")}))},onClose:function(){this.hasValue("start_date")?(QueryString.add("after",this.getValue("start_date")),this.options.opener.selectButton("date")):QueryString.remove("after"),this.hasValue("end_date")?(QueryString.add("before",this.getValue("end_date")),this.options.opener.selectButton("date")):QueryString.remove("before"),this.hasValue("start_date")||this.hasValue("end_date")||this.options.opener.deselectButton("date")}}),GeneraSelectorView=ItemsSelectorView.extend({item:_.template('\n\t\t<div class="item form-check">\n\t\t\t<input class="form-check-input" type="checkbox" id="item-<%= id %>">\n\t\t\t<label class="form-check-label" for="item-<%= id %>">\n\t\t\t\t<i><%= name %></i>\n\t\t\t</label>\n\t\t</div>\n\t'),onRender:function(){this.showGenera(this.options.genera),this.selectItemsFromQueryString("genera")},showGenera:function(t){this.$el.find(".list").empty();for(let e=0;e<t.length;e++)this.addItem(e,t.at(e))}}),GeneraSelectorDialogView=FilterDialogView.extend({className:"modal narrow",icon:"fa fa-mosquito",title:"Select Genera",template:_.template('\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">\n\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t</button>\n\t\t\t<h1 id="modal-header-text">\n\t\t\t\t<i class="<%= icon %>"></i>\n\t\t\t\t<%= title %>\n\t\t\t</h1>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<p>Please select the genera that you are interested in:</p>\n\t\t\t<div class="selector"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button id="ok" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i>OK</button>\n\t\t\t<button id="cancel" class="btn" data-dismiss="modal"><i class="fa fa-close"></i>Cancel</button>\n\t\t</div>\n\t'),regions:{selector:".selector"},templateContext:function(){return{icon:this.icon,title:this.title}},onRender:function(){this.showChildView("selector",new GeneraSelectorView({genera:this.options.genera}))},onClose:function(){let t=this.getChildView("selector").getSelectedIndices();t?(QueryString.add("genera",t),this.options.opener.selectButton("genera")):(QueryString.remove("genera",t),this.options.opener.deselectButton("genera"))}}),SpeciesSelectorView=ItemsSelectorView.extend({item:_.template('\n\t\t<div class="item form-check">\n\t\t\t<input class="form-check-input" type="checkbox" id="item-<%= id %>">\n\t\t\t<label class="form-check-label" for="item-<%= id %>">\n\t\t\t\t<i><%= name %></i>\n\t\t\t</label>\n\t\t</div>\n\t'),onRender:function(){this.showSpecies(this.options.species),this.selectItemsFromQueryString("species")},showSpecies:function(t){this.$el.find(".list").empty();for(let e=0;e<t.length;e++)this.addItem(e,t.at(e))}}),SpeciesSelectorDialogView=FilterDialogView.extend({className:"modal narrow",icon:"fa fa-mosquito",title:"Select Species",template:_.template('\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">\n\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t</button>\n\t\t\t<h1 id="modal-header-text">\n\t\t\t\t<i class="<%= icon %>" style="transform:scale(0.75)"></i>\n\t\t\t\t<%= title %>\n\t\t\t</h1>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<p>Please select the species that you are interested in:</p>\n\t\t\t<div class="selector"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button id="ok" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i>OK</button>\n\t\t\t<button id="cancel" class="btn" data-dismiss="modal"><i class="fa fa-close"></i>Cancel</button>\n\t\t</div>\n\t'),regions:{selector:".selector"},templateContext:function(){return{icon:this.icon,title:this.title}},onRender:function(){this.showChildView("selector",new SpeciesSelectorView({species:this.options.species}))},onClose:function(){let t=this.getChildView("selector").getSelectedIndices();t?(QueryString.add("species",t),this.options.opener.selectButton("species")):(QueryString.remove("species",t),this.options.opener.deselectButton("species"))}}),StatsView=BaseView.extend({template:_.template('\n\t\t<div class="habitat-mapper">\n\t\t\t<div class="swatch"></div>\n\t\t\tHabitat Mapper <span class="count"></span>\n\t\t</div>\n\t\t<div class="inaturalist">\n\t\t\t<div class="swatch"></div>\n\t\t\tiNaturalist <span class="count"></span>\n\t\t</div>\n\t\t<div class="land-cover">\n\t\t\t<div class="swatch"></div>\n\t\t\tLand Cover <span class="count"></span>\n\t\t</div>\n\t\t<div class="mosquito-alert">\n\t\t\t<div class="swatch"></div>\n\t\t\tMosquito Alert <span class="count"></span>\n\t\t</div>\n\t'),fetchObservationsCount:function(t,e){let i=config.server+"/observations/"+t.replace(/_/g,"-")+"/num";if(e.data){let t=QueryString.encode(e.data);t&&(i+="?"+t)}fetch(i).then((t=>t.text())).then((t=>{e&&e.success&&e.success(parseInt(t))}))},showObservationCount:function(t){this.fetchObservationsCount(t,{data:{countries:QueryString.value("countries"),before:QueryString.value("before"),after:QueryString.value("after"),genera:QueryString.value("genera"),species:QueryString.value("species")},success:e=>{this.$el.find("."+t.replace(/_/g,"-")+" .count").text("("+e.toLocaleString()+")")}})},onRender:function(){this.showObservationCount("habitat_mapper"),this.showObservationCount("inaturalist"),this.showObservationCount("land_cover"),this.showObservationCount("mosquito_alert")}}),StatsDialogView=DialogView.extend({className:"modal narrow",icon:"fa fa-table",title:"Statistics",template:_.template('\n\t\t<div class="modal-header">\n\t\t\t<button type="button" class="close" data-dismiss="modal" aria-hidden="true">\n\t\t\t\t<i class="fa fa-close"></i>\n\t\t\t</button>\n\t\t\t<h1 id="modal-header-text">\n\t\t\t\t<i class="<%= icon %>"></i>\n\t\t\t\t<%= title %>\n\t\t\t</h1>\n\t\t</div>\n\n\t\t<div class="modal-body">\n\t\t\t<p>Number of observations:</p>\n\t\t\t<div class="stats"></div>\n\t\t</div>\n\n\t\t<div class="modal-footer">\n\t\t\t<button id="ok" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i>OK</button>\n\t\t</div>\n\t'),regions:{stats:".stats"},templateContext:function(){return{icon:this.icon,title:this.title}},onRender:function(){this.showChildView("stats",new StatsView)}}),ViewBarView=ToolbarView.extend({id:"view-bar",className:"vertical toolbar",template:_.template('\n\t\t<div class="title">View</div>\n\n\t\t<div class="buttons">\n\n\t\t\t<button id="country" data-toggle="tooltip" title="Country" data-placement="right">\n\t\t\t\t<i class="fa fa-globe"></i>\n\t\t\t</button>\n\n\t\t\t<button id="date" data-toggle="tooltip" title="Date" data-placement="right">\n\t\t\t\t<i class="fa fa-calendar"></i>\n\t\t\t</button>\n\n\t\t\t<button id="genera" data-toggle="tooltip" title="Genera" data-placement="right">\n\t\t\t\t<i class="fa fa-mosquito"></i>\n\t\t\t</button>\n\n\t\t\t<button id="species" data-toggle="tooltip" title="Species" data-placement="right">\n\t\t\t\t<i class="fa fa-mosquito" style="transform:scale(0.75)"></i>\n\t\t\t</button>\n\n\t\t\t<button id="stats" data-toggle="tooltip" title="Stats" data-placement="right">\n\t\t\t\t<i class="fa fa-table"></i>\n\t\t\t</button>\n\n\t\t\t<button id="toggle-fullscreen" data-toggle="tooltip" title="Toggle Fullscreen" data-placement="right" class="desktop-only">\n\t\t\t\t<i class="fa fa-desktop"></i>\n\t\t\t</button>\n\t\t</div>\n\t'),events:{"click #country":"onClickCountry","click #date":"onClickDate","click #genera":"onClickGenera","click #species":"onClickSpecies","click #stats":"onClickStats","click #toggle-fullscreen":"onClickToggleFullscreen"},fetchCountries:function(t){(new Countries).fetch(t)},fetchGenera:function(t){$.ajax(config.server+"/genera",t)},fetchSpecies:function(t){$.ajax(config.server+"/species",t)},fetchAndShowCountriesDialog:function(){this.countries?this.showCountriesDialog(this.countries):(application.showSpinner(),this.fetchCountries({success:t=>{this.countries=t,application.hideSpinner(),this.showCountriesDialog(this.countries)}}))},fetchAndShowGeneraDialog:function(){this.genera?this.showGeneraDialog(this.genera):(application.showSpinner(),this.fetchGenera({success:t=>{this.genera=t,application.hideSpinner(),this.showGeneraDialog(this.genera)}}))},fetchAndShowSpeciesDialog:function(){this.species?this.showSpeciesDialog(this.species):(application.showSpinner(),this.fetchSpecies({success:t=>{this.species=t,application.hideSpinner(),this.showSpeciesDialog(this.species)}}))},isButtonSelected:function(t){return this.$el.find("#"+t).hasClass("selected")},isFullScreenSelected:function(){return this.isButtonSelected("toggle-fullscreen")},selectButton:function(t){this.$el.find("#"+t).addClass("selected")},deselectButton:function(t){this.$el.find("#"+t).removeClass("selected")},onRender:function(){ToolbarView.prototype.onRender.call(this),QueryString.has("countries")&&this.selectButton("country"),(QueryString.has("before")||QueryString.has("after"))&&this.selectButton("date"),QueryString.has("genera")&&this.selectButton("genera"),QueryString.has("species")&&this.selectButton("species")},showCountriesDialog:function(t){application.show(new CountriesSelectorDialogView({collection:t,opener:this}))},showDateDialog:function(){application.show(new DateRangeSelectorDialogView({opener:this}))},showGeneraDialog:function(t){application.show(new GeneraSelectorDialogView({genera:t,opener:this}))},showSpeciesDialog:function(t){application.show(new SpeciesSelectorDialogView({species:t,opener:this}))},showStatsDialog:function(){application.show(new StatsDialogView({opener:this}))},toggleFullScreen:function(){this.isFullScreenSelected()?(this.deselectButton("toggle-fullscreen"),this.parent.exitFullScreen()):(this.selectButton("toggle-fullscreen"),this.parent.requestFullScreen())},onClickCountry:function(){this.fetchAndShowCountriesDialog()},onClickDate:function(){this.showDateDialog()},onClickGenera:function(){this.fetchAndShowGeneraDialog()},onClickSpecies:function(){this.fetchAndShowSpeciesDialog()},onClickStats:function(){this.showStatsDialog()},onClickToggleFullscreen:function(){this.toggleFullScreen()}}),ObservationPopups={popupTemplate:_.template('\n\t\t<div class="title"><%= title %></div>\n\t\t<hr />\n\t\t<% let keys = Object.keys(attributes); %>\n\t\t<div class="buttons">\n\t\t\t<button class="social share btn"><i class="fa fa-share"></i>Share</button>\n\t\t</div>\n\t\t<% for (i = 0; i < keys.length; i++) { %>\n\t\t<% let key = keys[i]; %>\n\t\t<% let label = keys[i].toTitleCase().replace(/_/g, \' \'); %>\n\t\t<% let value = attributes[key]; %>\n\t\t<% if (value && value != \'None\' && key != \'photo_urls\' && key != \'thumb_urls\' && key != \'captions\') { %>\n\t\t<div class="value">\n\t\t\t<label><%= label %>:</label>\n\t\t\t<%= value %>\n\t\t</div>\n\t\t<% } %>\n\t\t<% } %>\n\t\t<% if (attributes.thumb_urls && attributes.photo_urls.length > 0) { %>\n\t\t<hr />\n\t\t<div class="photos">\n\t\t\t<% for (let i = 0; i < attributes.photo_urls.length; i++) { %>\n\t\t\t<% let photo_url = attributes.photo_urls[i]; %>\n\t\t\t<% let thumb_url = attributes.thumb_urls[i]; %>\n\t\t\t<% let caption = attributes.captions? attributes.captions[i] : null; %>\n\t\t\t<% if (thumb_url) { %>\n\t\t\t<div class="photo">\n\t\t\t\t<a style="background-image: url(\'<%= thumb_url %>\');" href="<%= photo_url %>" data-fancybox="gallery" class="lightbox"<% if (caption) { %> data-caption="<%= caption %>"<% } %>>\n\t\t\t\t\t\x3c!-- <img class="preview" src="<%= thumb_url %>" /> --\x3e\n\t\t\t\t</a>\n\t\t\t\t<% if (caption) { %><label><%= caption %></label><% } %>\n\t\t\t</div>\n\t\t\t<% } %>\n\t\t\t<% } %>\n\t\t</div>\n\t\t<% } %>\n\t'),formatName:function(t){if(!t||0==t.length)return t;let e=t.split(" ");for(let t=0;t<e.length;t++){let i=e[t];"insecta"==i.toLowerCase()||i.endsWith("dae")||(e[t]="<i>"+i+"</i>")}return e.join(" ")},fetchObservation:function(t,e,i){fetch(config.server+"/observations/"+t.replace(/_/g,"-")+"/"+e).then((t=>t.json())).then((t=>{i&&i.success&&i.success(t)}))},addLightBox:function(t){$(t).find(".lightbox").fancybox({padding:0,margin:20,openEffect:"elastic",closeEffect:"elastic",type:"image",autoResize:!0,fitToView:!0,loop:!0,buttons:["zoom","slideShow","fullScreen","download","thumbs","close"]})},hasNonNullObject:function(t){let e=Object.keys(t);for(let i=0;i<e.length;i++){if(null!=t[e[i]])return!0}return!1},getHabitatMapperPopupData:function(t){return{title:"Habitat Mapper",attributes:{date:new Date(t.mhm_measuredDate).toLocaleDateString(),time:new Date(t.mhm_measuredDate).toTimeString(),site:t.mhm_siteName,genus:this.formatName(t.mhm_Genus),species:this.formatName(t.mhm_Species),location:[t.y,t.x],habitat_type:t.mhm_WaterSourceType,habitat:t.mhm_WaterSource,thumb_urls:t.mhm_LarvaFullBodyPhotoUrls.concat(t.mhm_WaterSourcePhotoUrls),photo_urls:t.mhm_LarvaFullBodyPhotoUrls.concat(t.mhm_WaterSourcePhotoUrls)}}},getiNaturalistPopupData:function(t){return{title:"iNaturalist",attributes:{date:new Date(t.observationResCatObsPheTime).toLocaleDateString(),time:new Date(t.observationResCatObsPheTime).toTimeString(),location:[t.y,t.x],genus:this.formatName(t.Indentified_by_Human),common_name:t.ObsCPCommonName,thumb_urls:t.observationImaImaResult.map((t=>t.photo.url)),photo_urls:t.observationImaImaResult.map((t=>t.photo.url.replace("square","original")))}}},getLandCoverPopupData:function(t){return{title:"Land Cover",attributes:{date:new Date(t.phenomenonTime).toLocaleDateString(),time:new Date(t.phenomenonTime).toTimeString(),location:[t.y,t.x],thumb_urls:t.imageResult&&this.hasNonNullObject(t.imageResult)?[t.imageResult.lc_NorthPhotoUrl,t.imageResult.lc_SouthPhotoUrl,t.imageResult.lc_EastPhotoUrl,t.imageResult.lc_WestPhotoUrl,t.imageResult.lc_UpwardPhotoUrl,t.imageResult.lc_DownwardPhotoUrl]:[],photo_urls:t.imageResult&&this.hasNonNullObject(t.imageResult)?[t.imageResult.lc_NorthPhotoUrl,t.imageResult.lc_SouthPhotoUrl,t.imageResult.lc_EastPhotoUrl,t.imageResult.lc_WestPhotoUrl,t.imageResult.lc_UpwardPhotoUrl,t.imageResult.lc_DownwardPhotoUrl]:[],captions:["North","South","East","West","Up","Down"]}}},getMosquitoAlertPopupData:function(t){return{title:"Mosquito Alert",attributes:{date:new Date(t.observationResCatObsPheTime).toLocaleDateString(),time:new Date(t.observationResCatObsPheTime).toTimeString(),site:t.locationName,location:[t.y,t.x],species:this.formatName(t.Indentified_by_Human),"adult, bite, or site":t.dataStreamDescription,research_grade:t.omPrcoessResQuaQuaGrade,thumb_urls:t.observationImaImaResult?[t.observationImaImaResult]:null,photo_urls:t.observationImaImaResult?[t.observationImaImaResult]:null}}},getPopupData:function(t,e){switch(t){case"habitat_mapper":return this.getHabitatMapperPopupData(e);case"inaturalist":return this.getiNaturalistPopupData(e);case"land_cover":return this.getLandCoverPopupData(e);case"mosquito_alert":return this.getMosquitoAlertPopupData(e);default:alert("Unknown data source.")}},showMarkerPopup:function(t,e){let i=this.popupTemplate(this.getPopupData(t.options.source,e));$(t._path||t._icon).addClass("selected"),QueryString.add("selected",t.options.id),t.bindPopup(i).openPopup(),Browser.is_mobile&&$("#user-interface").hide();let s=t.getPopup(),n=s.getElement();$(n).find(".share").click((()=>{application.show(new ShareDialogView({link:window.location}))})),s&&s.isOpen()&&this.addLightBox(n),s.on("remove",(()=>{Browser.is_mobile&&$("#user-interface").show(),$(t._path||t._icon).removeClass("selected"),QueryString.remove("selected")}))},addObservationPopup:function(t){this.fetchObservation(t.options.source,t.options.id,{success:e=>{this.showMarkerPopup(t,e)}})}},MosquitoMapView=BaseMapView.extend(_.extend({},ObservationPopups,{icons:{},template:_.template('\n\t\t<div id="map"></div>\n\n\t\t<div id="user-interface" class="full-screen overlay">\n\t\t\t<div id="map-bar"></div>\n\t\t\t<div id="zoom-bar"></div>\n\t\t\t<div id="data-bar"></div>\n\t\t\t<div id="view-bar"></div>\n\t\t</div>\n\t'),regions:{map:{el:"#map-bar",replaceElement:!0},zoom:{el:"#zoom-bar",replaceElement:!0},data:{el:"#data-bar",replaceElement:!0},view:{el:"#view-bar",replaceElement:!0}},sources:["habitat_mapper","land_cover","inaturalist","mosquito_alert"],fetchObservations:function(t,e){let i=config.server+"/observations/"+t.replace(/_/g,"-");if(e.data){let t=QueryString.encode(e.data);t&&(i+="?"+t)}fetch(i).then((t=>t.json())).then((t=>{e&&e.success&&e.success(t)}))},getClusterGroup:function(t){return L.markerClusterGroup({options:Object.assign(L.MarkerClusterGroup.prototype.options,defaults.clustering),iconCreateFunction:function(e){const i=e.getAllChildMarkers().length,s=Math.trunc(15+6*Math.log10(i));return new L.DivIcon({html:`<div>${i}</div>`,className:t.replace(/_/g,"-")+" cluster",iconSize:new L.Point(s,s)})}})},getClusterGroups:function(t){let e={};for(let i=0;i<t.length;i++){let s=t[i];e[s]=this.getClusterGroup(s)}return e},addMapMarker:function(t,e,i,s){this.icons[e]||(this.icons[e]=new L.DivIcon({html:"<div></div>",className:e.replace(/_/g,"-")+" marker",iconSize:Browser.is_mobile?defaults.map.markerSize.mobile:defaults.map.markerSize.desktop}));let n=this.icons[e],o=L.marker([i.y,i.x],{icon:n,source:e,id:i.id});this.markers[i.id]=o,o.on("click",(()=>{this.addObservationPopup(o)})),i.id==s&&this.addObservationPopup(o),o.addTo(t)},addMapMarkers:function(t,e,i,s){for(let n=0;n<i.length;n++)this.addMapMarker(t,e,i[n],s)},addClusteredMarker:function(t,e,i,s){if(i.x&&i.y){let n=L.circleMarker([i.y,i.x],{source:e,id:i.id,radius:Browser.is_mobile?defaults.map.markerSize.mobile/2:defaults.map.markerSize.desktop/2,className:e.replace(/_/g,"-")+" marker"});this.markers[i.id]=n,n.on("click",(()=>{this.addObservationPopup(n)})),i.id==s&&this.addObservationPopup(n),t.addLayer(n)}},addClusteredMarkers:function(t,e,i,s){this.clusterGroups||(this.clusterGroups=this.getClusterGroups(this.sources));let n=this.clusterGroups[e];for(let t=0;t<i.length;t++)this.addClusteredMarker(n,e,i[t],s);return t.addLayer(n),n},removeMarkers:function(){if(this.clusterGroups)for(const t in this.clusterGroups){let e=this.clusterGroups[t];e.clearLayers(),this.map.removeLayer(e)}},showDataSource:function(t){this.$el.find("#map").removeClass("hide-"+t)},hideDataSource:function(t){this.$el.find("#map").addClass("hide-"+t)},addObservationMarkers:function(t,e){let i=QueryString.value("selected");this.fetchObservations(e,{data:{countries:QueryString.value("countries"),before:QueryString.value("before"),after:QueryString.value("after"),genera:QueryString.value("genera"),species:QueryString.value("species")},success:s=>{this.addClusteredMarkers(t,e,s,i)}})},addMarkers:function(){this.markers={};for(let t=0;t<this.sources.length;t++){let e=this.sources[t];this.addObservationMarkers(this.map,e)}},showMarkers:function(){this.removeMarkers(),this.addMarkers()},onAttach:function(){BaseMapView.prototype.onAttach.call(this),this.update()},update:function(){this.showMarkers()},showToolbar:function(t){switch(t){case"map":this.showMapBar();break;case"zoom":this.showZoomBar();break;case"data":this.showDataBar();break;case"view":this.showViewBar()}},showDataBar:function(){this.showChildView("data",new DataBarView({parent:this}))},showViewBar:function(){this.showChildView("view",new ViewBarView({parent:this}))}})),mainSplitView=SplitView.extend({orientation:$(window).width()<640?"vertical":"horizontal",flipped:!1,sizes:$(window).width()<640?[0,100]:[25,75],getMainBarView:function(){return new MosquitoMapView({el:this.$el.find(".mainbar")[0]})},getSideBarView:function(){return new SideBarView({selectedTerms:this.selectedTerms,expandedTerms:this.expandedTerms,selectedAppointments:this.selectedAppointments,expandedAppointments:this.expandedAppointments,showAffiliates:this.showAffiliates,onclick:t=>this.onClickCheckbox(t)})},getInitialSideBarSize:function(){return 60},onRender:function(){SplitView.prototype.onRender.call(this),$(window).bind("resize",(()=>{this.onResize()}))},onStart:function(){this.options.onstart&&this.options.onstart()},onResize:function(){this.hasChildView("mainbar")&&this.getChildView("mainbar").onResize&&this.getChildView("mainbar").onResize()}});export{mainSplitView as default};